(function(){"use strict";var t=this,e=function(){this.scripts=[],this.nodes=[],this.testsCreated=0,this.testsPending=0,this.testsFailed=0};e.prototype.test=function(t,e,s){this.scripts.push({testSource:t,testName:e,testScript:s})},e.prototype.runTests=function(t){this.testFunction=t;for(var e=0;e<this.scripts.length;e++){var s=this.scripts[e];this.testFunction({log:"loading test script: "+s.testName}),s.testScript(t)}this.completionCheck()},e.prototype.completionCheck=function(t){var e=this;!e.testsPending||t?(clearTimeout(e.watchdog),e.testFunction({done:!0,testsCreated:e.testsCreated,testsPending:e.testsPending,testsFailed:e.testsFailed})):e.watchdog=e.watchdog||setTimeout(function(){e.completionCheck(!0)},500)},e.prototype.githubMarkdown=function(){function t(){var t,e,s,n,o,i,a,p=0,c="",d="";for(s=r.test.testFunction.toString().match(/[^\r\n]+/g),n="",t=1;t<s.length-1;t++){if(o=s[t],1==t)for(p=0,e=0;e<o.length&&" "==o[e];e++)p++;for(e=0;e<o.length&&p>e&&" "==o[e];e++);for(i="";e<o.length;e++)i+=o[e];n+=n.length?"\n"+i:i}return c+="&nbsp;<b><i>"+r.text+":</i></b>",c+="\n```javascript\n"+n+"\n```",a=r.test.expectedValue,"object"==typeof r.test.expectedValue&&r.test.expectedValue.async&&(a=r.test.expectedValue.expectedValue),r.test.testThrown?d=r.test.testFailed?"error thrown: "+r.test.errorThrown+"\n":a?"<strong>"+a+"</strong> thrown as expected\n":"error thrown as expected\n":r.test.testFailed?r.test.returnValue!==a&&(d="ERROR got  <strong>"+r.test.returnValue+"</strong> expected <strong>"+a+"</strong>\n"):a&&(d="returns <strong>"+a+"</strong> as expected\n"),r.test.assertionsFailed&&(d.length&&(d+="<br>"),d+="Assertion(s) failed\n"),c+="\n<blockquote>"+d+"</blockquote>"}var e,s=this,n="";for(e=0;e<s.nodes.length;e++){var r=s.nodes[e];switch(e&&(n+="\n"),r.type){case"h":n+="#### "+r.text;break;case"e":n+=t();break;default:case"p":n+="<p>"+r.text+"</p>"}}return n},e.Node=function(t){if(t=t||{},this.type=t.type||null,!this.type||"h"!=this.type&&"p"!=this.type&&"e"!=this.type)throw new Error("Spec.Node type must be h, p or e")},e.Test=function(t,e,s){var n,r,o=this;t.testsCreated++,t.testsPending++,o.expectedValue=e,o.testFunction=s,o.testThrown=!1,o.testAsync=!1,o.assertionsMade=0,o.assertionsFailed=0;try{var i=o.testFunction(function(s){t.testsPending--,"undefined"!=typeof e&&e.async?(o.expectedValue.expectedValue!==s||o.assertionsFailed)&&t.testsFailed++:o.assertionsFailed&&(t.testsFailed++,o.testFailed=!0)});"undefined"!=typeof e?(o.testAsync=e.async,n=e instanceof Error?e.toString():e,r=i instanceof Error?i.toString():i,o.testAsync||(o.returnValue=r,n!==r?(t.testsFailed++,o.testFailed=!0,this.testFunction({error:"return value incorrect: "+r})):o.assertionsFailed&&(t.testsFailed++,o.testFailed=!0,this.testFunction({error:"assertions failed: "+r})))):o.assertionsFailed&&(t.testsFailed++,o.testFailed=!0)}catch(a){o.testThrown=!0,o.errorThrown=a,"undefined"!=typeof e&&e instanceof Error&&a.toString()===e.toString()||(t.testsFailed++,o.testFailed=!0,this.testFunction({error:"error thrown: "+a}))}o.testAsync||t.testsPending--},e.Test.prototype.shouldBeTrue=function(t){this.assertionsMade++,t!==!0&&this.assertionsFailed++},e.Test.prototype.shouldBeFalse=function(t){this.assertionsMade++,t!==!1&&this.assertionsFailed++},e.prototype.heading=function(t,s){if("string"!=typeof t||""===t)throw new Error("Spec.heading requires text argument");this.testFunction({log:"heading: "+t});var n=new e.Node({type:"h"});return n.text=t,this.nodes.push(n),s&&s(),n},e.prototype.paragraph=function(t){if("string"!=typeof t||""===t)throw new Error("Spec.paragraph requires text argument");this.testFunction({log:"paragraph: "+t});var s=new e.Node({type:"p"});return s.text=t,this.nodes.push(s),s},e.prototype.example=function(t,s,n){if("string"!=typeof t||""===t)throw new Error("Spec.example requires text argument");if(this.testFunction({log:"example: "+t}),"function"!=typeof n)throw new Error("Spec.example 3rd arg is function code or undefined");var r=new e.Node({type:"e"});return r.text=t,r.test=new e.Test(this,s,n),this.nodes.push(r),r},e.prototype.asyncResults=function(t){return{async:!0,expectedValue:t}},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.Spec=e):t.Spec=e}).call(this);