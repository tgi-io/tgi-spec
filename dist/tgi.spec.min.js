(function(){"use strict";var t=this,e=function(){this.scripts=[],this.nodes=[],this.testsCreated=0,this.testsPending=0,this.testsFailed=0};e.prototype.test=function(t,e,n){this.scripts.push({testSource:t,testName:e,testScript:n})},e.prototype.runTests=function(t){this.testFunction=t;for(var e=0;e<this.scripts.length;e++){var n=this.scripts[e];this.testFunction({log:"loading test script: "+n.testName}),n.testScript(t)}this.completionCheck()},e.prototype.completionCheck=function(t){var e=this;!e.testsPending||t?e.testFunction({done:!0,testsCreated:e.testsCreated,testsPending:e.testsPending,testsFailed:e.testsFailed}):e.watchdog=e.watchdog||setTimeout(function(){e.completionCheck(!0)},500)},e.prototype.githubMarkdown=function(){function t(){var t="";for(o=h.test.testFunction.toString().match(/[^\r\n]+/g),r="",n=1;n<o.length-1;n++){if(i=o[n],1==n)for(u=0,s=0;s<i.length&&" "==i[s];s++)u++;for(s=0;s<i.length&&u>s&&" "==i[s];s++);for(p="";s<i.length;s++)p+=i[s];r.length&&(r+=p+"\n"),r+=p}return t+="<em>EXAMPLE "+h.text+":</em>",t+="\n```javascript\n"+r+"\n```",t+="\n<blockquote>"+JSON.stringify(h.test)+"</blockquote>"}var e,n,s,o,r,i,p,c=this,a="",u=0;for(e=0;e<c.nodes.length;e++){var h=c.nodes[e];switch(e&&(a+="\n"),h.type){case"h":a+="#### "+h.text;break;case"e":a+=t();break;default:case"p":a+="<p>"+h.text+"</p>"}}return a},e.Node=function(t){if(t=t||{},this.type=t.type||null,!this.type||"h"!=this.type&&"p"!=this.type&&"e"!=this.type)throw new Error("Spec.Node type must be h, p or e")},e.Test=function(t,e,n){var s,o,r=this;t.testsCreated++,t.testsPending++,r.expectedValue=e,r.testFunction=n,r.testThrown=!1,r.testAsync=!1;try{var i=r.testFunction(function(n){t.testsPending--,"undefined"!=typeof e&&e.async&&(console.log("shizzle = "+JSON.stringify(n)),console.log("test.expectedValue.expectedValue = "+JSON.stringify(r.expectedValue.expectedValue)),r.expectedValue.expectedValue!==n&&t.testsFailed++)});"undefined"!=typeof e&&(r.testAsync=e.async,s=e instanceof Error?e.toString():e,o=i instanceof Error?i.toString():i,r.testAsync||s===o||t.testsFailed++)}catch(p){r.testThrown=!0,"undefined"!=typeof e&&e instanceof Error&&p.toString()===e.toString()||t.testsFailed++}r.testAsync||t.testsPending--},e.prototype.heading=function(t,n){if("string"!=typeof t||""===t)throw new Error("Spec.heading requires text argument");this.testFunction({log:"heading: "+t});var s=new e.Node({type:"h"});return s.text=t,this.nodes.push(s),n&&n(),s},e.prototype.paragraph=function(t){if("string"!=typeof t||""===t)throw new Error("Spec.paragraph requires text argument");this.testFunction({log:"paragraph: "+t});var n=new e.Node({type:"p"});return n.text=t,this.nodes.push(n),n},e.prototype.example=function(t,n,s){if("string"!=typeof t||""===t)throw new Error("Spec.example requires text argument");if(this.testFunction({log:"example: "+t}),"function"!=typeof s)throw new Error("Spec.example 3rd arg is function code or undefined");var o=new e.Node({type:"e"});return o.text=t,o.test=new e.Test(this,n,s),this.nodes.push(o),o},e.prototype.asyncResults=function(t){return{async:!0,expectedValue:t}},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.Spec=e):t.Spec=e}).call(this);