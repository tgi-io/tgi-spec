(function(){"use strict";var t=this,e=function(){var t=this;t.scripts=[],t.nodes=[],t.testsCreated=0,t.testsPending=0,t.testsFailed=0};e.prototype.test=function(t,e,s){this.scripts.push({testSource:t,testName:e,testScript:s})},e.prototype.runTests=function(t){var s=this;s.testCallback=t;for(var r=0;r<s.scripts.length;r++){var n=s.scripts[r];s.testCallback({log:"test script: "+n.testName});var o=new e.Node({type:"t"});o.text=n.testName,s.nodes.push(o),n.testScript(t)}s.completionCheck()},e.prototype.completionCheck=function(t){var e=this;!e.testsPending||t?(clearTimeout(e.watchdog),e.testCallback({done:!0,testsCreated:e.testsCreated,testsPending:e.testsPending,testsFailed:e.testsFailed})):e.watchdog=e.watchdog||setTimeout(function(){e.completionCheck(!0)},500)},e.prototype.githubMarkdown=function(){function t(){var t,e,s,r,o,a,i,c=0,p="",l="";for(s=n.test.testFunction.toString().match(/[^\r\n]+/g),r="",t=1;t<s.length-1;t++){if(o=s[t],1==t)for(c=0,e=0;e<o.length&&" "==o[e];e++)c++;for(e=0;e<o.length&&c>e&&" "==o[e];e++);for(a="";e<o.length;e++)a+=o[e];r+=r.length?"\n"+a:a}return p+="&nbsp;<b><i>"+n.text+":</i></b>",p+="\n```javascript\n"+r+"\n```",i=n.test.expectedValue,"object"==typeof n.test.expectedValue&&n.test.expectedValue.async&&(i=n.test.expectedValue.expectedValue),n.test.testThrown?l=n.test.testFailed?"error thrown: "+n.test.errorThrown+"\n":i?"<strong>"+i+"</strong> thrown as expected\n":"error thrown as expected\n":n.test.testFailed?n.test.returnValue!==i&&(l="ERROR got  <strong>"+n.test.returnValue+"</strong> expected <strong>"+i+"</strong>\n"):i&&(l="returns <strong>"+i+"</strong> as expected\n"),n.test.assertionsFailed&&(l.length&&(l+="<br>"),l+="Assertion(s) failed\n"),p+="\n<blockquote>"+l+"</blockquote>"}var e,s=this,r="";for(e=0;e<s.nodes.length;e++){var n=s.nodes[e];switch(e&&(r+="\n"),n.type){case"t":r+="## "+n.text;break;case"h":r+="#### "+n.text;break;case"e":r+=t();break;default:case"p":r+="<p>"+n.text+"</p>"}}return r},e.Node=function(t){if(t=t||{},this.type=t.type||null,!this.type||"t"!=this.type&&"h"!=this.type&&"p"!=this.type&&"e"!=this.type)throw new Error("Spec.Node type must be t, h, p or e")},e.Test=function(t,e,s){var r,n,o=this;t.testsCreated++,t.testsPending++,o.expectedValue=e,o.testFunction=s,o.testThrown=!1,o.testAsync=!1,o.assertionsMade=0,o.assertionsFailed=0;try{var a=o.testFunction(function(s){t.testsPending--,"undefined"!=typeof e&&e.async?o.expectedValue.expectedValue!=s&&(t.testsFailed++,o.testFailed=!0,t.testCallback({error:'callback return value incorrect: "'+s+'" expected "'+o.expectedValue.expectedValue+'"'})):o.assertionsFailed&&(t.testsFailed++,o.testFailed=!0,t.testCallback({error:"assertions failed: "+n}))});"undefined"!=typeof e?(o.testAsync=e.async,r=e instanceof Error?e.toString():e,n=a instanceof Error?a.toString():a,o.testAsync||(o.returnValue=n,r!=n?(t.testsFailed++,o.testFailed=!0,t.testCallback({error:'return value incorrect: "'+n+'" expected "'+r+'"'})):o.assertionsFailed&&(t.testsFailed++,o.testFailed=!0,t.testCallback({error:"assertions failed: "+n})))):o.assertionsFailed&&(t.testsFailed++,o.testFailed=!0,t.testCallback({error:"assertions failed: "+n}))}catch(i){o.testThrown=!0,o.errorThrown=i,"undefined"!=typeof e&&e instanceof Error&&i.toString()===e.toString()||(t.testsFailed++,o.testFailed=!0,t.testCallback({error:"error thrown: "+i}))}o.testAsync||t.testsPending--},e.Test.prototype.shouldBeTrue=function(t){this.assertionsMade++,t!==!0&&this.assertionsFailed++},e.Test.prototype.shouldBeFalse=function(t){this.assertionsMade++,t!==!1&&this.assertionsFailed++},e.Test.prototype.shouldThrowError=function(t,e){var s=!1;try{e()}catch(r){if(s=!0,void 0!==t&&t.toString()!=r.toString()&&"*"!=t.toString())throw"EXPECTED ERROR("+t+") GOT ERROR("+r+")"}if(!s)throw"EXPECTED ERROR("+t+")"},e.prototype.heading=function(t,s){var r=this;if("string"!=typeof t||""===t)throw new Error("Spec.heading requires text argument");r.testCallback({log:"heading: "+t});var n=new e.Node({type:"h"});return n.text=t,this.nodes.push(n),s&&s(),n},e.prototype.paragraph=function(t){var s=this;if("string"!=typeof t||""===t)throw new Error("Spec.paragraph requires text argument");s.testCallback({log:"paragraph: "+t});var r=new e.Node({type:"p"});return r.text=t,this.nodes.push(r),r},e.prototype.example=function(t,s,r){var n=this;if("string"!=typeof t||""===t)throw new Error("Spec.example requires text argument");if(n.testCallback({log:"example: "+t}),"function"!=typeof r)throw new Error("Spec.example 3rd arg is function code or undefined");var o=new e.Node({type:"e"});return o.text=t,o.test=new e.Test(this,s,r),this.nodes.push(o),o},e.prototype.asyncResults=function(t){return{async:!0,expectedValue:t}},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.Spec=e):t.Spec=e}).call(this);