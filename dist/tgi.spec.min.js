(function(){"use strict";var t=this,e=function(t){t=t||{};var e=this;e.scripts=[],e.nodes=[],e.testsCreated=0,e.testsPending=0,e.testsFailed=0,e.muted=!1,e.mutedTestsCreated=0,e.muteCount=0,e.timeOut=t.timeOut||500};e.prototype.test=function(t,e,s,r){this.scripts.push({testSource:t,testName:e,testDescription:s,testScript:r})},e.prototype.testSection=function(t,e){this.scripts.push({testSource:"Section",testName:t,testDescription:e})},e.prototype.runTests=function(t){var s,r=this;r.testCallback=t;for(var n=0;n<r.scripts.length;n++){var o=r.scripts[n];r.testCallback({log:"test script: "+o.testName+(r.muted?" (MUTED)":"")}),"Section"==o.testSource?((s=new e.Node({type:"s"})).muted=r.muted,s.text=o.testName,s.description=o.testDescription,r.nodes.push(s)):((s=new e.Node({type:"t"})).muted=r.muted,s.text=o.testName,s.description=o.testDescription,r.nodes.push(s),o.testScript(t))}(s=new e.Node({type:"t"})).muted=r.muted,s.text="Summary",s.description="for this spec.",r.nodes.push(s),r.completionCheck(),r.paragraph("This documentation generated with https://github.com/tgicloud/tgi-spec.<br>TODO put testin stats here.")},e.prototype.completionCheck=function(t){var e=this;if(!e.testsPending||t){if(clearTimeout(e.watchdog),e.testsPending)for(var s=0;s<this.nodes.length;s++){var r=this.nodes[s];"e"==r.type&&r.test.testAsync&&!r.test.asyncCalledBack&&console.log(r.text+": "+function(t,e,s){var r=typeof t;if(["function","undefined"].indexOf(r)>=0)return r;if(["string","number","boolean"].indexOf(r)>=0)return t;var n="{";for(var o in t)if(void 0!==e&&e)n+=o+", ";else{var i=typeof t[o];void 0===s&&(s=["function"]),s.indexOf(i)>=0?n+=o+": "+i+", ":n+=o+": "+t[o]+", "}return n+="}"}(r.test))}e.testCallback({done:!0,testsCreated:e.testsCreated,testsPending:e.testsPending,testsFailed:e.testsFailed})}else e.watchdog=e.watchdog||setTimeout(function(){e.completionCheck(!0)},e.timeOut)},e.prototype.githubMarkdown=function(){function t(t){return t.replace(/#/g,"").toLowerCase().replace(/ /g,"-")}function e(e){var s;for(s=e-1;s>=0;s--){var n=r.nodes[s];if("t"==n.type)return 1==e?"#"+t(n.text):"#-"+t(n.text)}return"#"}var s,r=this,n="";for(s=0;s<r.nodes.length;s++){var o=r.nodes[s],i=t(r.tocDesc)||"table-of-contents";if(!o.muted)switch(s&&(n+="\n"),o.type){case"t":0===s?n+="# "+o.text:!function(t){var e,s;for(e=0;e<r.nodes.length;e++)"t"==r.nodes[e].type&&(s=e);return s==t}(s)?n+="## [&#9664;]("+e(s)+")&nbsp;[&#8984;](#"+i+")&nbsp;[&#9654;]("+function(e){var s;for(s=e+1;s<r.nodes.length;s++){var n=r.nodes[s];if("t"==n.type)return"#-"+t(n.text)}return"#"}(s)+") &nbsp;"+o.text:n+="## [&#9664;]("+e(s)+")&nbsp;[&#8984;](#"+i+") &nbsp;"+o.text;break;case"h":n+="\n#### "+o.text;break;case"i":n+=function(e){var s,n="## "+e+"\n";for(s=1;s<r.nodes.length;s++){var o=r.nodes[s];"s"==o.type&&(n+="\n\n#### "+o.text),"t"==o.type&&"Summary"!=o.text&&(n+="\n- ["+o.text+"](#-"+t(o.text)+") "+o.description)}return n+"\n\n"}(r.tocDesc||"Table of Contents");break;case"e":n+=function(){var t,e,s,r,n,i,a,d,u=0,c="",p="";for(r=o.test.testFunction.toString().match(/[^\r\n]+/g),n="",e=1;e<r.length-1;e++){if(i=r[e],1==e)for(u=0,s=0;s<i.length&&" "==i[s];s++)u++;for(s=0;s<i.length&&s<u&&" "==i[s];s++);for(a="";s<i.length;s++)a+=i[s];n.length?n+="\n"+a:n+=a}if(c+="&nbsp;<b><i>"+o.text+":</i></b>",c+="\n\n```javascript\n"+n+"\n```",d=o.test.expectedValue,"object"==typeof o.test.expectedValue&&o.test.expectedValue.async&&(d=o.test.expectedValue.expectedValue),o.test.testThrown?p=o.test.testFailed?"error thrown: "+o.test.errorThrown+"\n":d?"<strong>"+d+"</strong> thrown as expected\n":"error thrown as expected\n":o.test.testFailed?o.test.returnValue!==d&&(p="ERROR got  <strong>"+o.test.returnValue+"</strong> expected <strong>"+d+"</strong>\n"):d&&(p="returns <strong>"+d+"</strong> as expected\n"),o.test.assertionsFailed&&(p.length&&(p+="<br>"),p+="Assertion(s) failed\n"),o.test.stuffLogged)for(t=0;t<o.test.stuffLogged.length;t++)p="<strong>log: </strong>"+o.test.stuffLogged[t]+"<br>"+p;return p&&(c+="\n<blockquote>"+p+"</blockquote>\n"),c}();break;case"p":n+=o.text+"    \n"}}return n},e.Node=function(t){if(t=t||{},this.type=t.type||null,!this.type||"s"!=this.type&&"t"!=this.type&&"h"!=this.type&&"i"!=this.type&&"p"!=this.type&&"e"!=this.type)throw new Error("Spec.Node type must be t, h, i, p or e")},(e.Test=function(t,e,s,r){var n,o,i=this;t.testsCreated++,t.testsPending++,i.expectedValue=e,i.testFunction=s,i.testThrown=!1,i.testAsync=!1,i.asyncCalledBack=!1,i.assertionsMade=0,i.assertionsFailed=0,i.stuffLogged=[];try{var a=i.testFunction(function(s){t.testsPending--,i.asyncCalledBack=!0,i.assertionsFailed?(t.testsFailed++,i.testFailed=!0,t.testCallback({error:'ex. "'+r+'": assertions failed: '+o})):void 0!==e&&e.async&&i.expectedValue.expectedValue!=s&&(t.testsFailed++,i.testFailed=!0,t.testCallback({error:'ex. "'+r+'": callback return value incorrect: "'+s+'" expected "'+i.expectedValue.expectedValue+'"'}))});o=a instanceof Error?a.toString():a,void 0!==e?(i.testAsync=e.async,n=e instanceof Error?e.toString():e,i.testAsync||(i.returnValue=o,n!=o?(t.testsFailed++,i.testFailed=!0,t.testCallback({error:'ex. "'+r+'": return value incorrect: "'+o+'" expected "'+n+'"'})):i.assertionsFailed&&(t.testsFailed++,i.testFailed=!0,t.testCallback({error:'ex. "'+r+'": assertions failed: '+o})))):i.assertionsFailed&&(t.testsFailed++,i.testFailed=!0,t.testCallback({error:'ex. "'+r+'": assertions failed: '+o}))}catch(s){i.testThrown=!0,i.errorThrown=s,void 0!==e&&e instanceof Error&&s.toString()===e.toString()||(t.testsFailed++,i.testFailed=!0,t.testCallback({error:'ex. "'+r+'": error thrown: '+s}))}i.testAsync||t.testsPending--}).prototype.shouldBeTrue=function(t){this.assertionsMade++,!0!==t&&(console.error("assertion failed "),this.assertionsFailed++)},e.Test.prototype.shouldBeFalse=function(t){this.assertionsMade++,!1!==t&&(console.error("assertion failed "),this.assertionsFailed++)},e.Test.prototype.shouldBeTruthy=function(t){this.assertionsMade++,t||(console.error("assertion failed "),this.assertionsFailed++)},e.Test.prototype.shouldBeFalsy=function(t){this.assertionsMade++,0!=t&&(console.error("assertion failed "),this.assertionsFailed++)},e.Test.prototype.shouldThrowError=function(t,e){var s=!1;try{e()}catch(e){if(s=!0,void 0!==t&&t.toString()!=e.toString()&&"*"!=t.toString())throw"EXPECTED ERROR("+t+") GOT ERROR("+e+")"}if(!s)throw"EXPECTED ERROR("+t+")"},e.Test.prototype.log=function(t){this.stuffLogged.unshift(t)},e.prototype.heading=function(t,s){var r=this;if("string"!=typeof t||""===t)throw new Error("Spec.heading requires text argument");r.testCallback({log:"heading: "+t+(r.muted?" (MUTED)":"")});var n=new e.Node({type:"h"});return n.muted=r.muted,n.text=t,this.nodes.push(n),s&&s(),n},e.prototype.paragraph=function(t){var s=this;if("string"!=typeof t||""===t)throw new Error("Spec.paragraph requires text argument");s.testCallback({log:"paragraph: "+t+(s.muted?" (MUTED)":"")});var r=new e.Node({type:"p"});return r.muted=s.muted,r.text=t,this.nodes.push(r),r},e.prototype.example=function(t,s,r){var n=this;if("string"!=typeof t||""===t)throw new Error("Spec.example requires text argument");if(n.testCallback({log:"example: "+t+(n.muted?" (MUTED)":"")}),"function"!=typeof r)throw new Error("Spec.example 3rd arg is function code or undefined");var o=new e.Node({type:"e"});return o.muted=n.muted,n.muted&&n.mutedTestsCreated++,o.text=t,o.test=new e.Test(this,s,r,t),this.nodes.push(o),o},e.prototype.xexample=function(){},e.prototype.index=function(t){var s=this,r=new e.Node({type:"i"});return r.muted=s.muted,s.tocDesc=t,s.nodes.push(r),r},e.prototype.asyncResults=function(t){return{async:!0,expectedValue:t}},e.prototype.mute=function(t){var e=this;return t?(e.muteCount||(e.mutedTestsCreated=0),e.muted=!0,e.muteCount++):(e.muteCount>0&&e.muteCount--,e.muteCount||(e.muted=!1)),{testsCreated:e.mutedTestsCreated}},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.Spec=e):t.Spec=e}).call(this);