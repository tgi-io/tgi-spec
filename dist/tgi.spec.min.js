(function(){"use strict";var t=this,e=function(){var t=this;t.scripts=[],t.nodes=[],t.testsCreated=0,t.testsPending=0,t.testsFailed=0,t.muted=!1,t.mutedTestsCreated=0};e.prototype.test=function(t,e,s,r){this.scripts.push({testSource:t,testName:e,testDescription:s,testScript:r})},e.prototype.testSection=function(t,e){this.scripts.push({testSource:"Section",testName:t,testDescription:e})},e.prototype.runTests=function(t){var s,r=this;r.testCallback=t;for(var n=0;n<r.scripts.length;n++){var o=r.scripts[n];r.testCallback({log:"test script: "+o.testName}),"Section"==o.testSource?(s=new e.Node({type:"s"}),s.muted=r.muted,s.text=o.testName,s.description=o.testDescription,r.nodes.push(s)):(s=new e.Node({type:"t"}),s.muted=r.muted,s.text=o.testName,s.description=o.testDescription,r.nodes.push(s),o.testScript(t))}s=new e.Node({type:"t"}),s.muted=r.muted,s.text="Summary",s.description="for this spec.",r.nodes.push(s),r.completionCheck(),r.paragraph("This documentation generated with https://github.com/tgicloud/tgi-spec.<br>TODO put testin stats here.")},e.prototype.completionCheck=function(t){var e=this;!e.testsPending||t?(clearTimeout(e.watchdog),e.testCallback({done:!0,testsCreated:e.testsCreated,testsPending:e.testsPending,testsFailed:e.testsFailed})):e.watchdog=e.watchdog||setTimeout(function(){e.completionCheck(!0)},500)},e.prototype.githubMarkdown=function(){function t(){var t,s="###Table of Contents\n";for(t=1;t<a.nodes.length;t++){var r=a.nodes[t];"s"==r.type&&(s+="\n\n#### "+r.text),"t"==r.type&&"Summary"!=r.text&&(s+="\n- ["+r.text+"](#-"+e(r.text)+") "+r.description)}return s+"\n\n"}function e(t){return t.toLowerCase().replace(/ /g,"-")}function s(t){var s;for(s=t-1;s>=0;s--){var r=a.nodes[s];if("t"==r.type)return 1==t?"#"+e(r.text):"#-"+e(r.text)}return"#"}function r(t){var s;for(s=t+1;s<a.nodes.length;s++){var r=a.nodes[s];if("t"==r.type)return"#-"+e(r.text)}return"#"}function n(t){var e,s;for(e=0;e<a.nodes.length;e++){var r=a.nodes[e];"t"==r.type&&(s=e)}return s==t}function o(){var t,e,s,r,n,o,i,a,d=0,u="",c="";for(r=p.test.testFunction.toString().match(/[^\r\n]+/g),n="",e=1;e<r.length-1;e++){if(o=r[e],1==e)for(d=0,s=0;s<o.length&&" "==o[s];s++)d++;for(s=0;s<o.length&&d>s&&" "==o[s];s++);for(i="";s<o.length;s++)i+=o[s];n+=n.length?"\n"+i:i}if(u+="&nbsp;<b><i>"+p.text+":</i></b>",u+="\n```javascript\n"+n+"\n```",a=p.test.expectedValue,"object"==typeof p.test.expectedValue&&p.test.expectedValue.async&&(a=p.test.expectedValue.expectedValue),p.test.testThrown?c=p.test.testFailed?"error thrown: "+p.test.errorThrown+"\n":a?"<strong>"+a+"</strong> thrown as expected\n":"error thrown as expected\n":p.test.testFailed?p.test.returnValue!==a&&(c="ERROR got  <strong>"+p.test.returnValue+"</strong> expected <strong>"+a+"</strong>\n"):a&&(c="returns <strong>"+a+"</strong> as expected\n"),p.test.assertionsFailed&&(c.length&&(c+="<br>"),c+="Assertion(s) failed\n"),p.test.stuffLogged)for(t=0;t<p.test.stuffLogged.length;t++){var l=p.test.stuffLogged[t];c="<strong>log: </strong>"+l+"<br>"+c}return c&&(u+="\n<blockquote>"+c+"</blockquote>"),u}var i,a=this,d="";for(i=0;i<a.nodes.length;i++){var p=a.nodes[i];if(!p.muted)switch(i&&(d+="\n"),p.type){case"t":d+=0===i?"#"+p.text:n(i)?"## [&#9664;]("+s(i)+")&nbsp;[&#8984;](#table-of-contents) &nbsp;"+p.text:"## [&#9664;]("+s(i)+")&nbsp;[&#8984;](#table-of-contents)&nbsp;[&#9654;]("+r(i)+") &nbsp;"+p.text;break;case"h":d+="#### "+p.text;break;case"i":d+=t();break;case"e":d+=o();break;case"p":d+=p.text+"    \n"}}return d},e.Node=function(t){if(t=t||{},this.type=t.type||null,!this.type||"s"!=this.type&&"t"!=this.type&&"h"!=this.type&&"i"!=this.type&&"p"!=this.type&&"e"!=this.type)throw new Error("Spec.Node type must be t, h, i, p or e")},e.Test=function(t,e,s){var r,n,o=this;t.testsCreated++,t.testsPending++,o.expectedValue=e,o.testFunction=s,o.testThrown=!1,o.testAsync=!1,o.assertionsMade=0,o.assertionsFailed=0,o.stuffLogged=[];try{var i=o.testFunction(function(s){t.testsPending--,"undefined"!=typeof e&&e.async?o.expectedValue.expectedValue!=s&&(t.testsFailed++,o.testFailed=!0,t.testCallback({error:'callback return value incorrect: "'+s+'" expected "'+o.expectedValue.expectedValue+'"'})):o.assertionsFailed&&(t.testsFailed++,o.testFailed=!0,t.testCallback({error:"assertions failed: "+n}))});n=i instanceof Error?i.toString():i,"undefined"!=typeof e?(o.testAsync=e.async,r=e instanceof Error?e.toString():e,o.testAsync||(o.returnValue=n,r!=n?(t.testsFailed++,o.testFailed=!0,t.testCallback({error:'return value incorrect: "'+n+'" expected "'+r+'"'})):o.assertionsFailed&&(t.testsFailed++,o.testFailed=!0,t.testCallback({error:"assertions failed: "+n})))):o.assertionsFailed&&(t.testsFailed++,o.testFailed=!0,t.testCallback({error:"assertions failed: "+n}))}catch(a){o.testThrown=!0,o.errorThrown=a,"undefined"!=typeof e&&e instanceof Error&&a.toString()===e.toString()||(t.testsFailed++,o.testFailed=!0,t.testCallback({error:"error thrown: "+a}))}o.testAsync||t.testsPending--},e.Test.prototype.shouldBeTrue=function(t){this.assertionsMade++,t!==!0&&this.assertionsFailed++},e.Test.prototype.shouldBeFalse=function(t){this.assertionsMade++,t!==!1&&this.assertionsFailed++},e.Test.prototype.shouldBeTruthy=function(t){this.assertionsMade++,t||this.assertionsFailed++},e.Test.prototype.shouldBeFalsy=function(t){this.assertionsMade++,0!=t&&this.assertionsFailed++},e.Test.prototype.shouldThrowError=function(t,e){var s=!1;try{e()}catch(r){if(s=!0,void 0!==t&&t.toString()!=r.toString()&&"*"!=t.toString())throw"EXPECTED ERROR("+t+") GOT ERROR("+r+")"}if(!s)throw"EXPECTED ERROR("+t+")"},e.Test.prototype.log=function(t){this.stuffLogged.push(t)},e.prototype.heading=function(t,s){var r=this;if("string"!=typeof t||""===t)throw new Error("Spec.heading requires text argument");r.testCallback({log:"heading: "+t});var n=new e.Node({type:"h"});return n.muted=r.muted,n.text=t,this.nodes.push(n),s&&s(),n},e.prototype.paragraph=function(t){var s=this;if("string"!=typeof t||""===t)throw new Error("Spec.paragraph requires text argument");s.testCallback({log:"paragraph: "+t});var r=new e.Node({type:"p"});return r.muted=s.muted,r.text=t,this.nodes.push(r),r},e.prototype.example=function(t,s,r){var n=this;if("string"!=typeof t||""===t)throw new Error("Spec.example requires text argument");if(n.testCallback({log:"example: "+t}),"function"!=typeof r)throw new Error("Spec.example 3rd arg is function code or undefined");var o=new e.Node({type:"e"});return o.muted=n.muted,n.muted&&n.mutedTestsCreated++,o.text=t,o.test=new e.Test(this,s,r),this.nodes.push(o),o},e.prototype.xexample=function(){},e.prototype.index=function(){var t=this,s=new e.Node({type:"i"});return s.muted=t.muted,t.nodes.push(s),s},e.prototype.asyncResults=function(t){return{async:!0,expectedValue:t}},e.prototype.mute=function(t){var e=this;return t?(e.mutedTestsCreated=0,e.muted=!0):e.muted=!1,{testsCreated:e.mutedTestsCreated}},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.Spec=e):t.Spec=e}).call(this);